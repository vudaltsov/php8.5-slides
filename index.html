<html lang="ru">
<head>
    <meta charset="utf-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.2.1/reset.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.2.1/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.2.1/theme/simple.min.css" id="theme">
    <link rel="stylesheet" href="highlight-phpstorm-light-theme.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'TTCommons';
            src: url('./fonts/TTCommons-Regular.ttf') format('truetype');
        }
        @font-face {
            font-family: 'TTCommons';
            src: url('./fonts/TTCommons-Black.ttf') format('truetype');
            font-weight: bold;
        }
        @font-face {
            font-family: 'TTCommons';
            src: url('./fonts/TTCommons-Italic.ttf') format('truetype');
            font-style: italic;
        }
        :root {
            --r-main-font: 'TTCommons', 'Montserrat', 'Noto Color Emoji', sans-serif;
            --r-heading-font: 'TTCommons', 'Montserrat', 'Noto Color Emoji', sans-serif;
            --r-code-font: 'Montserrat Mono', 'Noto Color Emoji', monospace;
            --r-block-margin: 20px;
            --r-link-color: #cc375d;
            --r-link-color-hover: #962c47;
            --r-heading2-size: 2.6em;
            --r-heading-font-weight: 500;
            --r-gray: #aaaaaa;
        }
        section {
            display: flex;
            align-items: center;
            justify-items: center;
        }
        .reveal pre {
            font-size: .55em;
            display: flex;
            flex-direction: column;
            width: auto;
            min-width: 70%;
            border-radius: 1em;
            overflow: hidden;
            border: 4px solid var(--r-gray);
            background: var(--r-gray);
            box-shadow: none;
        }
        .reveal pre:before {
            padding: .5em 1em;
        }
        .reveal pre.php-gte-85 {
            border-color: var(--r-link-color);
            background: var(--r-link-color);
        }
        .reveal pre.php-gte-85:before {
            content: 'PHP >= 8.5';
            color: white;
        }
        .reveal pre.php-lt-85:before {
            content: 'PHP < 8.5';
            color: white;
        }
        .reveal .hljs:not(:first-child).fragment {
            top: 2.2em;
        }
        .reveal pre > code {
            max-height: none;
        }
        .nohighlight {
            padding: 1em !important;
        }
        .reveal .hljs {
            min-height: auto;
        }
        td.hljs-ln-code {
            white-space: pre;
        }
        .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6, .reveal pre, .reveal p, .reveal img {
            margin: 0 var(--r-block-margin) calc(var(--r-block-margin) * 2);
        }
        .reveal .r-stack > * {
            margin: 0;
        }
        .horizontal {
            display: flex;
            width: 100%;
            justify-content: space-between;
        }
        .horizontal > * {
            flex-grow: 1;
        }
        .horizontal-half > * {
            flex-grow: 0 !important;
            width: calc(50% - var(--r-block-margin) * 2) !important;
        }
        .reveal .slide-number {
            top: 3.4%;
            right: -15.8%;
            width: 60px;
            bottom: inherit;
            background: none;
            color: #838383;
            font-size: 0.9em;
            text-align: center;
            padding: 0 !important;
            margin: 0 !important;
        }
        .reveal .present ~ .slide-number {
            display: none !important;
        }
        .rfc, .pr {
            font-size: 1.4em;
            line-height: 1.1em;
            position: relative;
            display: block;
            text-align: left;
            margin-bottom: calc(var(--r-block-margin) * 2);
        }
        .rfc {
            padding-left: 2.6em;
        }
        .pr {
            padding-left: 2em;
        }
        .rfc:before {
            content: 'RFC';
        }
        .pr:before {
            content: 'PR';
        }
        .rfc:before, .pr:before {
            display: block;
            position: absolute;
            top: -0.3em;
            bottom: 0;
            left: 0;
            background: var(--r-link-color);
            border-radius: 8px;
            color: white;
            padding: 0 0.4em;
            font-size: 0.8em;
            line-height: 1.9em;
        }
        .rfc:hover:before, .pr:hover:before {
            background: var(--r-link-color-hover);
        }
    </style>
    <title>PHP 8.5 не сбавляет темп!</title>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-background-image="title_bg.png" data-background-size="contain"></section>

        <div class="slide-number"></div>

        <section data-background-image="bg.png" data-background-size="contain">
            <h3>Как получить первый&nbsp;элемент&nbsp;массива?</h3>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $first = reset($array);

                    if ($first === false) {
                        // $array is empty or first value is false
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $first = null;

                    foreach ($array as $value) {
                        $first = $value;

                        break;
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $firstKey = array_key_first($array);

                    if ($firstKey === null) {
                        $first = null;
                    } else {
                        $first = $array[$firstKey];
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $first = array_values($array)[0] ?? null;
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $first = array_shift($array);
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $reversed = array_reverse($array);

                    $first = array_pop($reversed);
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $first = array_reduce(
                        $array,
                        static fn($carry, $value) => $carry ?? $value,
                    );
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $first = new ArrayIterator($array)->current();
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <p><a class="rfc" href="https://wiki.php.net/rfc/array_first_last" target="_blank">array_first() and array_last()</a></p>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    $first = array_first($array);

                    $last = array_last($array);
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    /**
                     * ???
                     */
                    function array_first(array $array): mixed
                    {
                        // ...
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    /**
                     * @template T
                     * @param array&lt;T&gt; $array
                     * @return ?T
                     */
                    function array_first(array $array): mixed
                    {
                        // ...
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    /**
                     * @template T
                     * @param array&lt;T&gt; $array
                     * @return ($array is non-empty-array ? T : ?T)
                     */
                    function array_first(array $array): mixed
                    {
                        // ...
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    /**
                     * @template T
                     * @param array&lt;T&gt; $array
                     * @return (
                     *     $array is array{} ? null :
                     *     $array is non-empty-array ? T :
                     *     ?T
                     * )
                     */
                    function array_first(array $array): mixed
                    {
                        // ...
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <p><a class="rfc" href="https://wiki.php.net/rfc/url_parsing_api" target="_blank">Add RFC 3986 and WHATWG URL compliant API</a></p>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <p><a class="rfc" href="https://wiki.php.net/rfc/clone_with_v2" target="_blank">Clone with v2</a></p>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    namespace Thesis\Amqp;

                    final readonly class Message
                    {
                        public function __construct(
                            public string $body = '',
                            public array $headers = [],
                            public ?string $contentType = null,
                            public ?string $contentEncoding = null,
                            public DeliveryMode $deliveryMode = DeliveryMode::Whatever,
                            public ?int $priority = null,
                            public ?string $correlationId = null,
                            // ...
                        ) {}
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim data-line-numbers="|8">
                    return new Message(
                        body: $message->body,
                        headers: $message->headers,
                        contentType: $message->contentType,
                        contentEncoding: $message->contentEncoding,
                        deliveryMode: $message->deliveryMode,
                        priority: $message->priority,
                        correlationId: $correlationId,
                        // ...
                    );
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    final readonly class Message
                    {
                        // ...

                        public function withCorrelationId(?string $correlationId): self
                        {
                            $message = clone $this;

                            // ❌ Cannot modify readonly property
                            $message->correlationId = $correlationId;

                            return $message;
                        }
                    }

                    $message = $message->withCorrelationId('...');
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    final readonly class Message
                    {
                        // ...

                        public function withCorrelationId(?string $correlationId): self
                        {
                            // ✅ 🥹
                            return new self(
                                body: $this->body,
                                // ...
                                correlationId: $correlationId,
                                // ...
                            );
                        }
                    }

                    $message = $message->withCorrelationId('...');
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    final readonly class Message
                    {
                        // ...

                        public function withCorrelationId(?string $correlationId): self
                        {
                            // ✅ 🙂
                            return new self(...[
                                ...get_object_vars($this),
                                'correlationId' => $correlationId,
                            ]);
                        }
                    }

                    $message = $message->withCorrelationId('...');
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    final readonly class Message
                    {
                        // ...

                        public function withCorrelationId(?string $correlationId): self
                        {
                            // ✅ 🤩
                            return clone($this, [
                                'correlationId' => $correlationId,
                            ]);
                        }
                    }

                    $message = $message->withCorrelationId('...');
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    final readonly class Message
                    {
                        // ...
                    }

                    $message = clone(new Message(), [
                        'correlationId' => $correlationId,
                    ]);
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    final readonly class Message
                    {
                        // ...
                    }

                    // ❌ Cannot modify protected(set) readonly property
                    // ❌ Message::$correlationId from global scope

                    $message = clone(new Message(), [
                        'correlationId' => $correlationId,
                    ]);
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <a class="rfc" href="https://wiki.php.net/rfc/marking_return_value_as_important" target="_blank">#[NoDiscard]</a>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim data-line-numbers="|9">
                    namespace Yiisoft\Validator;

                    interface ValidatorInterface
                    {
                        public function validate(
                            mixed $data,
                            callable|iterable|object|string|null $rules = null,
                            ?ValidationContext $context = null,
                        ): Result;
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    new Validator()->validate(0, new Number(min: 1));
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $result = new Validator()->validate(0, new Number(min: 1));

                    // false 😲
                    dump($result->isValid());
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim data-line-numbers="|5">
                    final class Validator implements ValidatorInterface
                    {
                        // ...

                        #[\NoDiscard('Неправильно, широкую на широкую надо!!!')]
                        public function validate(/** args */): Result
                        {
                            // ...
                        }

                        // ...
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    // ⚠️ Warning: The return value of method
                    // ⚠️ Validator::validate() should either be used
                    // ⚠️ or intentionally ignored by casting it as (void),
                    // ⚠️ Неправильно, широкую на широкую надо!!!

                    new Validator()->validate(0, new Number(min: 1));
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim>
                    public function testRuleWithoutHandler(): void
                    {
                        $this->expectException(RuleHandlerNotFoundException::class);

                        $validator = new Validator();

                        // ⚠️ Warning
                        $validator->validate(/** args */);
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim data-line-numbers="|8">
                    public function testRuleWithoutHandler(): void
                    {
                        $this->expectException(RuleHandlerNotFoundException::class);

                        $validator = new Validator();

                        // ✅
                        (void) $validator->validate(/** args */);
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <div>
                <a class="rfc" href="https://wiki.php.net/rfc/closures_in_const_expr" target="_blank">Closures in constant expressions</a>
                <a class="rfc" href="https://wiki.php.net/rfc/fcc_in_const_expr" target="_blank">First Class Callables in constant expressions</a>
            </div>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <div>
                <a class="rfc" href="https://wiki.php.net/rfc/curl_share_persistence" target="_blank">Add persistent curl share handles</a>
                <a class="rfc" href="https://wiki.php.net/rfc/curl_share_persistence_improvement" target="_blank">Persistent curl share handle improvement</a>
            </div>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <a class="rfc" href="https://wiki.php.net/rfc/static-aviz" target="_blank">Asymmetric Visibility <br>for Static Properties</a>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <a class="pr" href="https://github.com/php/php-src/pull/18167" target="_blank">Implement Closure::getCurrent()<br>to retrieve current closure</a>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    function fibonacci(int $n): int
                    {
                        return match ($n) {
                            0 => 0,
                            1 => 1,
                            default => fibonacci($n - 1) + fibonacci($n - 2)
                        };
                    }
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $fibonacci = static function (int $n): int {
                        return match ($n) {
                            0 => 0,
                            1 => 1,
                            //         ???                 ???
                            default => fibonacci($n - 1) + fibonacci($n - 2)
                        };
                    };
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-lt-85">
                <code class="language-php" data-trim>
                    $fibonacci = static function (int $n) use (&$fibonacci): int {
                        return match ($n) {
                            0 => 0,
                            1 => 1,
                            default => $fibonacci($n - 1) + $fibonacci($n - 2)
                        };
                    };
                </code>
            </pre>
        </section>

        <section data-background-image="bg.png" data-background-size="contain">
            <pre class="php-gte-85">
                <code class="language-php" data-trim data-line-numbers="|2,7">
                    $fibonacci = static function (int $n): int {
                        $self = Closure::getCurrent();

                        return match ($n) {
                            0 => 0,
                            1 => 1,
                            default => $self($n - 1) + $self($n - 2)
                        };
                    };
                </code>
            </pre>
        </section>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.2.1/reveal.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.2.1/plugin/highlight/highlight.min.js"></script>
<script>
    Reveal.initialize({
        controls: false,
        progress: true,
        history: true,
        plugins: [RevealHighlight],
        slideNumber: true,
        autoAnimate: true,
    }).then((event) => {
        let curNum = (Reveal.getRevealElement()).querySelector(".reveal > .slide-number");
        let newNum = (Reveal.getRevealElement()).querySelector(".reveal > * .slide-number");
        let newNumClassList = newNum.classList;

        if (curNum && newNum ) {
            newNum.parentNode.replaceChild(curNum, newNum);
            curNum.classList = newNumClassList;
        }
    });
</script>
</body>
</html>
